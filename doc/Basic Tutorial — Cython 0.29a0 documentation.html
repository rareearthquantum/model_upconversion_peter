<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Basic Tutorial — Cython 0.29a0 documentation</title>
    <link rel="stylesheet" href="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/nature.css" type="text/css">
    <link rel="stylesheet" href="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/pygments.css" type="text/css">
    <link rel="stylesheet" href="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/badge_only.css" type="text/css">
    <script async="" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/analytics.js"></script><script type="text/javascript" id="documentation_options" data-url_root="../../" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/documentation_options.js"></script>
    <script type="text/javascript" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/jquery-2.js"></script>
    <script type="text/javascript" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/jquery-migrate-1.js"></script>
    <script type="text/javascript" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/underscore.js"></script>
    <script type="text/javascript" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/doctools.js"></script>
    <script type="text/javascript" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/readthedocs-doc-embed.js"></script>
    <link rel="shortcut icon" href="http://cython.readthedocs.io/en/latest/_static/favicon.ico">
    <link rel="search" title="Search" href="http://cython.readthedocs.io/en/latest/search.html">
    <link rel="next" title="Calling C functions" href="http://cython.readthedocs.io/en/latest/src/tutorial/external.html">
    <link rel="prev" title="Tutorials" href="http://cython.readthedocs.io/en/latest/src/tutorial/index.html"> 
  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="https://cython.readthedocs.io/en/latest/src/tutorial/cython_tutorial.html">

<link rel="stylesheet" href="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/readthedocs-doc-embed.css" type="text/css">

<script type="text/javascript" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'src/tutorial/cython_tutorial'
READTHEDOCS_DATA['source_suffix'] = '.rst'
</script>

<script type="text/javascript" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="http://cython.readthedocs.io/en/latest/src/tutorial/external.html" title="Calling C functions" accesskey="N">next</a></li>
        <li class="right">
          <a href="http://cython.readthedocs.io/en/latest/src/tutorial/index.html" title="Tutorials" accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="http://cython.readthedocs.io/en/latest/index.html">Cython 0.29a0 documentation</a> »</li>
          <li class="nav-item nav-item-1"><a href="http://cython.readthedocs.io/en/latest/src/tutorial/index.html" accesskey="U">Tutorials</a> »</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="basic-tutorial">
<span id="tutorial"></span><h1>Basic Tutorial<a class="headerlink" href="#basic-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-basics-of-cython">
<h2>The Basics of Cython<a class="headerlink" href="#the-basics-of-cython" title="Permalink to this headline">¶</a></h2>
<p>The fundamental nature of Cython can be summed up as follows: Cython is Python
with C data types.</p>
<p>Cython is Python: Almost any piece of Python code is also valid Cython code.
(There are a few <a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/userguide/limitations.html#cython-limitations"><span class="std std-ref">Limitations</span></a>, but this approximation will
serve for now.) The Cython compiler will convert it into C code which makes
equivalent calls to the Python/C API.</p>
<p>But Cython is much more than that, because parameters and variables can be
declared to have C data types. Code which manipulates Python values and C
values can be freely intermixed, with conversions occurring automatically
wherever possible. Reference count maintenance and error checking of Python
operations is also automatic, and the full power of Python’s exception
handling facilities, including the try-except and try-finally statements, is
available to you – even in the midst of manipulating C data.</p>
</div>
<div class="section" id="cython-hello-world">
<h2>Cython Hello World<a class="headerlink" href="#cython-hello-world" title="Permalink to this headline">¶</a></h2>
<p>As Cython can accept almost any valid python source file, one of the hardest
things in getting started is just figuring out how to compile your extension.</p>
<p>So lets start with the canonical python hello world:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s">"Hello World"</span><span class="p">)</span>
</pre></div>
</div>
<p>Save this code in a file named <code class="file docutils literal notranslate"><span class="pre">helloworld.pyx</span></code>.  Now we need to create
the <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code>, which is like a python Makefile (for more information
see <a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#compilation"><span class="std std-ref">Source Files and Compilation</span></a>). Your <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> should look like:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">from</span> <span class="nn">distutils.core</span> <span class="k">import</span> <span class="n">setup</span>
<span class="k">from</span> <span class="nn">Cython.Build</span> <span class="k">import</span> <span class="n">cythonize</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">ext_modules</span> <span class="o">=</span> <span class="n">cythonize</span><span class="p">(</span><span class="s">"helloworld.pyx"</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>To use this to build your Cython file use the commandline options:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ python setup.py build_ext --inplace
</pre></div>
</div>
<p>Which will leave a file in your local directory called <code class="file docutils literal notranslate"><span class="pre">helloworld.so</span></code> in unix
or <code class="file docutils literal notranslate"><span class="pre">helloworld.pyd</span></code> in Windows. Now to use this file: start the python
interpreter and simply import it as if it was a regular python module:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">import</span> <span class="nn">helloworld</span>
<span class="n">Hello</span> <span class="n">World</span>
</pre></div>
</div>
<p>Congratulations! You now know how to build a Cython extension. But so far
this example doesn’t really give a feeling why one would ever want to use Cython, so
lets create a more realistic example.</p>
<div class="section" id="pyximport-cython-compilation-for-developers">
<h3><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyximport</span></code>: Cython Compilation for Developers<a class="headerlink" href="#pyximport-cython-compilation-for-developers" title="Permalink to this headline">¶</a></h3>
<p>If your module doesn’t require any extra C libraries or a special
build setup, then you can use the pyximport module, originally developed
by Paul Prescod, to load .pyx files directly on import, without having
to run your <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file each time you change your code.
It is shipped and installed with Cython and can be used like this:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">import</span> <span class="nn">pyximport</span><span class="p">;</span> <span class="n">pyximport</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">import</span> <span class="nn">helloworld</span>
<span class="n">Hello</span> <span class="n">World</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/reference/compilation.html#pyximport"><span class="std std-ref">Pyximport</span></a> module also has experimental
compilation support for normal Python modules.  This allows you to
automatically run Cython on every .pyx and .py module that Python
imports, including the standard library and installed packages.
Cython will still fail to compile a lot of Python modules, in which
case the import mechanism will fall back to loading the Python source
modules instead.  The .py import mechanism is installed like this:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">pyximport</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">pyimport</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that it is not recommended to let <a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/reference/compilation.html#pyximport"><span class="std std-ref">Pyximport</span></a> build code
on end user side as it hooks into their import system.  The best way
to cater for end users is to provide pre-built binary packages in the
<a class="reference external" href="https://wheel.readthedocs.io/">wheel</a> packaging format.</p>
</div>
</div>
<div class="section" id="fibonacci-fun">
<h2>Fibonacci Fun<a class="headerlink" href="#fibonacci-fun" title="Permalink to this headline">¶</a></h2>
<p>From the official Python tutorial a simple fibonacci function is defined as:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">"""Print the Fibonacci series up to n."""</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">1</span>
    <span class="k">while</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">' '</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

    <span class="k">print</span><span class="p">()</span>
</pre></div>
</div>
<p>Now following the steps for the Hello World example we first rename the file
to have a <cite>.pyx</cite> extension, lets say <code class="file docutils literal notranslate"><span class="pre">fib.pyx</span></code>, then we create the
<code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file. Using the file created for the Hello World example, all
that you need to change is the name of the Cython filename, and the resulting
module name, doing this we have:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">from</span> <span class="nn">distutils.core</span> <span class="k">import</span> <span class="n">setup</span>
<span class="k">from</span> <span class="nn">Cython.Build</span> <span class="k">import</span> <span class="n">cythonize</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">ext_modules</span><span class="o">=</span><span class="n">cythonize</span><span class="p">(</span><span class="s">"fib.pyx"</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Build the extension with the same command used for the helloworld.pyx:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ python setup.py build_ext --inplace
</pre></div>
</div>
<p>And use the new extension with:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">import</span> <span class="nn">fib</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fib</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="mf">2000</span><span class="p">)</span>
<span class="mf">1</span> <span class="mf">1</span> <span class="mf">2</span> <span class="mf">3</span> <span class="mf">5</span> <span class="mf">8</span> <span class="mf">13</span> <span class="mf">21</span> <span class="mf">34</span> <span class="mf">55</span> <span class="mf">89</span> <span class="mf">144</span> <span class="mf">233</span> <span class="mf">377</span> <span class="mf">610</span> <span class="mf">987</span> <span class="mf">1597</span>
</pre></div>
</div>
</div>
<div class="section" id="primes">
<span id="id1"></span><h2>Primes<a class="headerlink" href="#primes" title="Permalink to this headline">¶</a></h2>
<p>Here’s a small example showing some of what can be done. It’s a routine for
finding prime numbers. You tell it how many primes you want, and it returns
them as a Python list.</p>
<p><code class="file docutils literal notranslate"><span class="pre">primes.pyx</span></code>:</p>
<div class="highlight-cython notranslate"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">primes</span><span class="p">(</span><span class="nb">int</span> <span class="n">nb_primes</span><span class="p">):</span>
    <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">n</span><span class="p">,</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">len_p</span>
    <span class="k">cdef</span> <span class="kt">int</span> <span class="kt">p</span>[1000]
    <span class="k">if</span> <span class="n">nb_primes</span> <span class="o">&gt;</span> <span class="mf">1000</span><span class="p">:</span>
        <span class="n">nb_primes</span> <span class="o">=</span> <span class="mf">1000</span>

    <span class="n">len_p</span> <span class="o">=</span> <span class="mf">0</span>  <span class="c"># The current number of elements in p.</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mf">2</span>
    <span class="k">while</span> <span class="n">len_p</span> <span class="o">&lt;</span> <span class="n">nb_primes</span><span class="p">:</span>
        <span class="c"># Is n prime?</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[:</span><span class="n">len_p</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c"># If no break occurred in the loop, we have a prime.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="n">len_p</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
            <span class="n">len_p</span> <span class="o">+=</span> <span class="mf">1</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mf">1</span>

    <span class="c"># Let's return the result in a python list:</span>
    <span class="n">result_as_list</span>  <span class="o">=</span> <span class="p">[</span><span class="n">prime</span> <span class="k">for</span> <span class="n">prime</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[:</span><span class="n">len_p</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">result_as_list</span>
</pre></div>
</td></tr></tbody></table></div>
<p>You’ll see that it starts out just like a normal Python function definition,
except that the parameter <code class="docutils literal notranslate"><span class="pre">nb_primes</span></code> is declared to be of type <code class="docutils literal notranslate"><span class="pre">int</span></code> . This
means that the object passed will be converted to a C integer (or a
<code class="docutils literal notranslate"><span class="pre">TypeError.</span></code> will be raised if it can’t be).</p>
<p>Now, let’s dig into the core of the function:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">cdef</span> <span class="kt">int</span> <span class="nf">n</span><span class="p">,</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">len_p</span>
<span class="k">cdef</span> <span class="kt">int</span> <span class="kt">p</span>[1000]
</pre></div>
</div>
<p>Lines 2 and 3 use the <code class="docutils literal notranslate"><span class="pre">cdef</span></code> statement to define some local C variables.
The result is stored in the C array <code class="docutils literal notranslate"><span class="pre">p</span></code> during processing,
and will be copied into a Python list at the end (line 22).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You cannot create very large arrays in this manner, because
they are allocated on the C function call stack, which is a
rather precious and scarce resource.
To request larger arrays,
or even arrays with a length only known at runtime,
you can learn how to make efficient use of
<a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/tutorial/memory_allocation.html#memory-allocation"><span class="std std-ref">C memory allocation</span></a>,
<a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/tutorial/array.html#array-array"><span class="std std-ref">Python arrays</span></a>
or <a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/userguide/memoryviews.html#memoryviews"><span class="std std-ref">NumPy arrays</span></a> with Cython.</p>
</div>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">nb_primes</span> <span class="o">&gt;</span> <span class="mf">1000</span><span class="p">:</span>
    <span class="n">nb_primes</span> <span class="o">=</span> <span class="mf">1000</span>
</pre></div>
</div>
<p>As in C, declaring a static array requires knowing the size at compile time.
We make sure the user doesn’t set a value above 1000 (or we would have a
segmentation fault, just like in C).</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="n">len_p</span> <span class="o">=</span> <span class="mf">0</span>  <span class="c"># The number of elements in p</span>
<span class="n">n</span> <span class="o">=</span> <span class="mf">2</span>
<span class="k">while</span> <span class="n">len_p</span> <span class="o">&lt;</span> <span class="n">nb_primes</span><span class="p">:</span>
</pre></div>
</div>
<p>Lines 7-9 set up for a loop which will test candidate numbers for primeness
until the required number of primes has been found.</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="c"># Is n prime?</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[:</span><span class="n">len_p</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
<p>Lines 11-12, which try dividing a candidate by all the primes found so far,
are of particular interest. Because no Python objects are referred to,
the loop is translated entirely into C code, and thus runs very fast.
You will notice the way we iterate over the <code class="docutils literal notranslate"><span class="pre">p</span></code> C array.</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[:</span><span class="n">len_p</span><span class="p">]:</span>
</pre></div>
</div>
<p>The loop gets translated into a fast C loop and works just like iterating
over a Python list or NumPy array.  If you don’t slice the C array with
<code class="docutils literal notranslate"><span class="pre">[:len_p]</span></code>, then Cython will loop over the 1000 elements of the array.</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="c"># If no break occurred in the loop</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">p</span><span class="p">[</span><span class="n">len_p</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
    <span class="n">len_p</span> <span class="o">+=</span> <span class="mf">1</span>
<span class="n">n</span> <span class="o">+=</span> <span class="mf">1</span>
</pre></div>
</div>
<p>If no breaks occurred, it means that we found a prime, and the block of code
after the <code class="docutils literal notranslate"><span class="pre">else</span></code> line 16 will be executed. We add the prime found to <code class="docutils literal notranslate"><span class="pre">p</span></code>.
If you find having an <code class="docutils literal notranslate"><span class="pre">else</span></code> after a for-loop strange, just know that it’s a
lesser known features of the Python language, and that Cython executes it at
C speed for you.
If the for-else syntax confuses you, see this excellent
<a class="reference external" href="https://shahriar.svbtle.com/pythons-else-clause-in-loops">blog post</a>.</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="c"># Let's put the result in a python list:</span>
<span class="n">result_as_list</span>  <span class="o">=</span> <span class="p">[</span><span class="n">prime</span> <span class="k">for</span> <span class="n">prime</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[:</span><span class="n">len_p</span><span class="p">]]</span>
<span class="k">return</span> <span class="n">result_as_list</span>
</pre></div>
</div>
<p>In line 22, before returning the result, we need to copy our C array into a
Python list, because Python can’t read C arrays.  Cython can automatically
convert many C types from and to Python types, as described in the
documentation on <a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#type-conversion"><span class="std std-ref">type conversion</span></a>, so we can use
a simple list comprehension here to copy the C <code class="docutils literal notranslate"><span class="pre">int</span></code> values into a Python
list of Python <code class="docutils literal notranslate"><span class="pre">int</span></code> objects, which Cython creates automatically along the way.
You could also have iterated manually over the C array and used
<code class="docutils literal notranslate"><span class="pre">result_as_list.append(prime)</span></code>, the result would have been the same.</p>
<p>You’ll notice we declare a Python list exactly the same way it would be in Python.
Because the variable <code class="docutils literal notranslate"><span class="pre">result_as_list</span></code> hasn’t been explicitly declared with a type,
it is assumed to hold a Python object, and from the assignment, Cython also knows
that the exact type is a Python list.</p>
<p>Finally, at line 18, a normal
Python return statement returns the result list.</p>
<p>Compiling primes.pyx with the Cython compiler produces an extension module
which we can try out in the interactive interpreter as follows:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">import</span> <span class="nn">primes</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">primes</span><span class="o">.</span><span class="n">primes</span><span class="p">(</span><span class="mf">10</span><span class="p">)</span>
<span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">3</span><span class="p">,</span> <span class="mf">5</span><span class="p">,</span> <span class="mf">7</span><span class="p">,</span> <span class="mf">11</span><span class="p">,</span> <span class="mf">13</span><span class="p">,</span> <span class="mf">17</span><span class="p">,</span> <span class="mf">19</span><span class="p">,</span> <span class="mf">23</span><span class="p">,</span> <span class="mf">29</span><span class="p">]</span>
</pre></div>
</div>
<p>See, it works! And if you’re curious about how much work Cython has saved you,
take a look at the C code generated for this module.</p>
<p>Cython has a way to visualise where interaction with Python objects and
Python’s C-API is taking place. For this, pass the
<code class="docutils literal notranslate"><span class="pre">annotate=True</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">cythonize()</span></code>. It produces a HTML file. Let’s see:</p>
<div class="figure">
<img alt="../../_images/htmlreport1.png" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/htmlreport1.png">
</div>
<p>If a line is white, it means that the code generated doesn’t interact
with Python, so will run as fast as normal C code.  The darker the yellow, the more
Python interaction there is in that line.  Those yellow lines will usually operate
on Python objects, raise exceptions, or do other kinds of higher-level operations
than what can easily be translated into simple and fast C code.
The function declaration and return use the Python interpreter so it makes
sense for those lines to be yellow. Same for the list comprehension because
it involves the creation of a Python object. But the line <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">n</span> <span class="pre">%</span> <span class="pre">i</span> <span class="pre">==</span> <span class="pre">0:</span></code>, why?
We can examine the generated C code to understand:</p>
<div class="figure">
<img alt="../../_images/python_division.png" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/python_division.png">
</div>
<p>We can see that some checks happen. Because Cython defaults to the
Python behavior, the language will perform division checks at runtime,
just like Python does. You can deactivate those checks by using the
<a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/reference/compilation.html#compiler-directives"><span class="std std-ref">compiler directives</span></a>.</p>
<p>Now let’s see if, even if we have division checks, we obtained a boost in speed.
Let’s write the same program, but Python-style:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">primes_python</span><span class="p">(</span><span class="n">nb_primes</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mf">2</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nb_primes</span><span class="p">:</span>
        <span class="c"># Is n prime?</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c"># If no break occurred in the loop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mf">1</span>
    <span class="k">return</span> <span class="n">p</span>
</pre></div>
</div>
<p>It is also possible to take a plain <code class="docutils literal notranslate"><span class="pre">.py</span></code> file and to compile it with Cython.
Let’s take <code class="docutils literal notranslate"><span class="pre">primes_python</span></code>, change the function name to <code class="docutils literal notranslate"><span class="pre">primes_python_compiled</span></code> and
compile it with Cython (without changing the code). We will also change the name of the
file to <code class="docutils literal notranslate"><span class="pre">example_py_cy.py</span></code> to differentiate it from the others.
Now the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> looks like this:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">from</span> <span class="nn">distutils.core</span> <span class="k">import</span> <span class="n">setup</span>
<span class="k">from</span> <span class="nn">Cython.Build</span> <span class="k">import</span> <span class="n">cythonize</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">ext_modules</span><span class="o">=</span><span class="n">cythonize</span><span class="p">([</span><span class="s">'example.pyx'</span><span class="p">,</span>        <span class="c"># Cython code file with primes() function</span>
                           <span class="s">'example_py_cy.py'</span><span class="p">],</span>  <span class="c"># Python code file with primes_python_compiled() function</span>
                          <span class="n">annotate</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>        <span class="c"># enables generation of the html annotation file</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now we can ensure that those two programs output the same values:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">primes_python</span><span class="p">(</span><span class="mf">1000</span><span class="p">)</span> <span class="o">==</span> <span class="n">primes</span><span class="p">(</span><span class="mf">1000</span><span class="p">)</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">primes_python_compiled</span><span class="p">(</span><span class="mf">1000</span><span class="p">)</span> <span class="o">==</span> <span class="n">primes</span><span class="p">(</span><span class="mf">1000</span><span class="p">)</span>
<span class="bp">True</span>
</pre></div>
</div>
<p>It’s possible to compare the speed now:</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">timeit</span> <span class="o">-</span><span class="n">s</span> <span class="s">'from example_py import primes_python'</span> <span class="s">'primes_python(1000)'</span>
<span class="mf">10</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mf">3</span><span class="p">:</span> <span class="mf">23</span> <span class="n">msec</span> <span class="n">per</span> <span class="n">loop</span>

<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">timeit</span> <span class="o">-</span><span class="n">s</span> <span class="s">'from example_py_cy import primes_python_compiled'</span> <span class="s">'primes_python_compiled(1000)'</span>
<span class="mf">100</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mf">3</span><span class="p">:</span> <span class="mf">11.9</span> <span class="n">msec</span> <span class="n">per</span> <span class="n">loop</span>

<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">timeit</span> <span class="o">-</span><span class="n">s</span> <span class="s">'from example import primes'</span> <span class="s">'primes(1000)'</span>
<span class="mf">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mf">3</span><span class="p">:</span> <span class="mf">1.65</span> <span class="n">msec</span> <span class="n">per</span> <span class="n">loop</span>
</pre></div>
</div>
<p>The cythonize version of <code class="docutils literal notranslate"><span class="pre">primes_python</span></code> is 2 times faster than the Python one,
without changing a single line of code.
The Cython version is 13 times faster than the Python version! What could explain this?</p>
<dl class="docutils">
<dt>Multiple things:</dt>
<dd><ul class="first last simple">
<li>In this program, very little computation happen at each line.
So the overhead of the python interpreter is very important. It would be
very different if you were to do a lot computation at each line. Using NumPy for
example.</li>
<li>Data locality. It’s likely that a lot more can fit in CPU cache when using C than
when using Python. Because everything in python is an object, and every object is
implemented as a dictionary, this is not very cache friendly.</li>
</ul>
</dd>
</dl>
<p>Usually the speedups are between 2x to 1000x. It depends on how much you call
the Python interpreter. As always, remember to profile before adding types
everywhere. Adding types makes your code less readable, so use them with
moderation.</p>
</div>
<div class="section" id="primes-with-c">
<h2>Primes with C++<a class="headerlink" href="#primes-with-c" title="Permalink to this headline">¶</a></h2>
<p>With Cython, it is also possible to take advantage of the C++ language, notably,
part of the C++ standard library is directly importable from Cython code.</p>
<p>Let’s see what our <code class="file docutils literal notranslate"><span class="pre">primes.pyx</span></code> becomes when
using <a class="reference external" href="https://en.cppreference.com/w/cpp/container/vector">vector</a> from the C++
standard library.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Vector in C++ is a data structure which implements a list or stack based
on a resizeable C array. It is similar to the Python <code class="docutils literal notranslate"><span class="pre">array</span></code>
type in the <code class="docutils literal notranslate"><span class="pre">array</span></code> standard library module.
There is a method <cite>reserve</cite> available which will avoid copies if you know in advance
how many elements you are going to put in the vector. For more details
see <a class="reference external" href="https://en.cppreference.com/w/cpp/container/vector">this page from cppreference</a>.</p>
</div>
<div class="highlight-cython notranslate"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c"># distutils: language=c++</span>

<span class="k">from</span> <span class="nn">libcpp.vector</span> <span class="k">cimport</span> <span class="n">vector</span>

<span class="k">def</span> <span class="nf">primes</span><span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="n">nb_primes</span><span class="p">):</span>
    <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">n</span><span class="p">,</span> <span class="nf">i</span>
    <span class="k">cdef</span> <span class="kt">vector</span>[<span class="kt">int</span>] <span class="nf">p</span>
    <span class="n">p</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">nb_primes</span><span class="p">)</span>  <span class="c"># allocate memory for 'nb_primes' elements.</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mf">2</span>
    <span class="k">while</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">nb_primes</span><span class="p">:</span>  <span class="c"># size() for vectors is similar to len()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c"># push_back is similar to append()</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mf">1</span>

    <span class="c"># Vectors are automatically converted to Python</span>
    <span class="c"># lists when converted to Python objects.</span>
    <span class="k">return</span> <span class="n">p</span>
</pre></div>
</td></tr></tbody></table></div>
<p>The first line is a compiler directive. It tells Cython to compile your code to C++.
This will enable the use of C++ language features and the C++ standard library.
Note that it isn’t possible to compile Cython code to C++ with <cite>pyximport</cite>. You
should use a <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> or a notebook to run this example.</p>
<p>You can see that the API of a vector is similar to the API of a Python list,
and can sometimes be used as a drop-in replacement in Cython.</p>
<p>For more details about using C++ with Cython, see <a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/userguide/wrapping_CPlusPlus.html#wrapping-cplusplus"><span class="std std-ref">Using C++ in Cython</span></a>.</p>
</div>
<div class="section" id="language-details">
<h2>Language Details<a class="headerlink" href="#language-details" title="Permalink to this headline">¶</a></h2>
<p>For more about the Cython language, see <a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/userguide/language_basics.html#language-basics"><span class="std std-ref">Language Basics</span></a>.
To dive right in to using Cython in a numerical computation context,
see <a class="reference internal" href="http://cython.readthedocs.io/en/latest/src/userguide/memoryviews.html#memoryviews"><span class="std std-ref">Typed Memoryviews</span></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="http://cython.readthedocs.io/en/latest/index.html">
              <img class="logo" src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/cythonlogo.png" alt="Logo">
            </a></p>
  <h3><a href="http://cython.readthedocs.io/en/latest/index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Basic Tutorial</a><ul>
<li><a class="reference internal" href="#the-basics-of-cython">The Basics of Cython</a></li>
<li><a class="reference internal" href="#cython-hello-world">Cython Hello World</a><ul>
<li><a class="reference internal" href="#pyximport-cython-compilation-for-developers"><code class="docutils literal notranslate"><span class="pre">pyximport</span></code>: Cython Compilation for Developers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fibonacci-fun">Fibonacci Fun</a></li>
<li><a class="reference internal" href="#primes">Primes</a></li>
<li><a class="reference internal" href="#primes-with-c">Primes with C++</a></li>
<li><a class="reference internal" href="#language-details">Language Details</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="http://cython.readthedocs.io/en/latest/src/tutorial/index.html" title="previous chapter">Tutorials</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="http://cython.readthedocs.io/en/latest/src/tutorial/external.html" title="next chapter">Calling C functions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="http://cython.readthedocs.io/en/latest/_sources/src/tutorial/cython_tutorial.rst.txt" rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input name="q" type="text">
      <input value="Go" type="submit">
      <input name="check_keywords" value="yes" type="hidden">
      <input name="area" value="default" type="hidden">
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="http://cython.readthedocs.io/en/latest/src/tutorial/external.html" title="Calling C functions">next</a></li>
        <li class="right">
          <a href="http://cython.readthedocs.io/en/latest/src/tutorial/index.html" title="Tutorials">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="http://cython.readthedocs.io/en/latest/index.html">Cython 0.29a0 documentation</a> »</li>
          <li class="nav-item nav-item-1"><a href="http://cython.readthedocs.io/en/latest/src/tutorial/index.html">Tutorials</a> »</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        © Copyright 2018, Stefan Behnel, Robert Bradshaw, Dag Sverre 
Seljebotn, Greg Ewing, William Stein, Gabriel Gellner, et al..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="Basic%20Tutorial%20%E2%80%94%20Cython%200.29a0%20documentation_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6139100-3");
pageTracker._trackPageview();
} catch(err) {}</script>

  
<!-- Inserted RTD Footer -->
<div class="injected">

  
  <div class="rst-versions rst-badge" data-toggle="rst-versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book">&nbsp;</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      

      
      
      
      <dl>
        <dt>Versions</dt>
        
         <strong> 
        <dd><a href="https://cython.readthedocs.io/en/latest/src/tutorial/cython_tutorial.html">latest</a></dd>
         </strong> 
        
        
        <dd><a href="https://cython.readthedocs.io/en/stable/src/tutorial/cython_tutorial.html">stable</a></dd>
        
        
      </dl>
      
      

      
      
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="http://readthedocs.org/projects/cython/downloads/pdf/latest/">PDF</a></dd>
        
        <dd><a href="http://readthedocs.org/projects/cython/downloads/htmlzip/latest/">HTML</a></dd>
        
        <dd><a href="http://readthedocs.org/projects/cython/downloads/epub/latest/">Epub</a></dd>
        
      </dl>
      
      

      
      <dl>
        <!-- These are kept as relative links for internal installs that are http -->
        <dt>On Read the Docs</dt>
        <dd>
          <a href="http://readthedocs.org/projects/cython/">Project Home</a>
        </dd>
        <dd>
          <a href="http://readthedocs.org/projects/cython/builds/">Builds</a>
        </dd>
        <dd>
          <a href="http://readthedocs.org/projects/cython/downloads/">Downloads</a>
        </dd>
      </dl>
      

      

      
      <dl>
        <dt>On GitHub</dt>
        <dd>
          <a href="https://github.com/cython/cython/blob/master/docs/src/tutorial/cython_tutorial.rst">View</a>
        </dd>
        <dd>
          <a href="https://github.com/cython/cython/edit/master/docs/src/tutorial/cython_tutorial.rst">Edit</a>
        </dd>
      </dl>
      
      

      
      <dl>
        <dt>Search</dt>
        <dd>
          <div style="padding: 6px;">
            <form id="flyout-search-form" class="wy-form" target="_blank" action="//readthedocs.org/projects/cython/search/" method="get">
              <input name="q" placeholder="Search docs" type="text">
              </form>
          </div>
        </dd>
      </dl>
      



      <hr>
      
        <small>
          <span>Hosted by <a href="https://readthedocs.org/">Read the Docs</a></span>
          <span> · </span>
          <a href="https://docs.readthedocs.io/en/latest/privacy-policy.html">Privacy Policy</a>
        </small>
      

      
    </div>
  </div>
  

</div>
</body></html>